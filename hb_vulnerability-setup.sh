#! /bin/bash
# A script to prepare a ubuntu 12.04.5 device to be vulnerable
# to the heartbleed bug. 

# Created by Jamie Coupe as a python3 version of a Heartbleed IDS tool created
# as part of his honours project.

# Set constants
DEPENDANCIES_FOLDER="dependencies"
GREEN='\033[0;32m'
RED='\033[0;31m'
BLUE='\033[0;34m'
NC='\033[0m' # No colour

# Function to install a package
function install_package() {
	local folder=$1
	local packages=$2

	echo $folder
	echo "${packages[@]}"

	for i in "${packages[@]}"
	do 
	        echo -ne "${BLUE}Installing $lib:"

	        if dpkg -i "$1/$2"; then
	       	        echo -e "${GREEN}Installed Successfully"
	        else
	               	echo -e "${RED}Failed to install"
        	fi
	done


}

echo -e  "Starting Heartbleed Setup"

# Check version of machines
echo -ne  "${BLUE}Carrying out version check: "

release=$(lsb_release -d)
if [[ $release = *"12.04.5"*  ]]
then
	echo -e "${GREEN}Right Version (12.04.5)"
else
	echo -e "${RED}Wrong version"
	echo -e "Quitting${NC}"
	exit 1
fi

# Install libprce3 and dependancies (3, cpp0, dev in order)
echo -e "${BLUE}Installing libprce3 and dependancies"

declare -a libpcre3_packages=(libpcre3_8.12-4_amd64.deb libpcrecpp0_8.12-4_amd64.deb libpcre3-dev_8.12-4_amd64.deb)

echo "${libpcre3_packages[@]}"
install_package "dependencies/libpcre" "${libpcre3_packages[@]}"


#if ! dpkg -i libpcre3_8.12-4_amd64.deb ; then 
#	echo -e "${RED} Failed to install $package"
#else 
#	echo -e 	

#dpkg -i libpcrecpp0_8.12-4_amd64.deb
#dpkg -i libpcre3-dev_8.12-4_amd64.deb 




# Exit Statement
echo -e "Complete${NC} "
exit 0
